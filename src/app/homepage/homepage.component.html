<div
  *ngIf="spotifyUser$ | async as user; else notConnected"
  fxFlexFill
  fxLayout="row"
>
  <div
    *ngIf="(user$ | async)?.playlistIds.length > 0; else noTracks"
    fxFlexFill
    fxLayout="row"
  >
    <!----------------- LEFT BAR ----------------->
    <div fxFlexOffset="10" fxFlex="25" fxFlexFill>
      <div fxLayout="column" fxFlexFill>
        <div fxFlexOffset="10" fxFlex="90" class="left-bar">
          <mat-tab-group mat-align-tabs="center" fxFlexFill>
            <mat-tab label="Playlists">
              <div fxLayout="row" fxLayoutAlign="center center">
                <div fxFlex="90"><app-playlist-list></app-playlist-list></div>
              </div>
            </mat-tab>
            <mat-tab label="Filters">
              <div fxLayout="row" fxLayoutAlign="center center">
                <div fxFlex="80">
                  <app-genre-list></app-genre-list>
                  <app-filter-list></app-filter-list>
                </div>
              </div>
            </mat-tab>
          </mat-tab-group>
        </div>
      </div>
    </div>
    <!----------------- RIGHT BAR ----------------->
    <div fxFlex="40" fxFlexOffset="5" fxFlexFill>
      <div fxLayout="column" fxFlexFill>
        <div fxLayout="column" fxFlexFill>
          <div fxFlexOffset="5" class="header" fxFlex="15">
            <h1>Tracklist</h1>
            <mat-divider></mat-divider>
            <p>
              {{ this.trackNumber$ | async }} tracks
              <button mat-icon-button (click)="playAll()">
                <mat-icon>play_circle_outline</mat-icon>
              </button>
              <button mat-icon-button (click)="savePlaylist()">
                <mat-icon>save</mat-icon>
              </button>
              <button mat-icon-button (click)="refreshData()">
                <mat-icon>refresh</mat-icon>
              </button>
            </p>
          </div>
          <!----------------- TRACK LIST ----------------->
          <div
            class="track-list"
            fxFlex="80"
            *ngIf="
              (activePlaylistIds$ | async)?.length > 0;
              else noActivePlaylist
            "
          >
            <app-track-list></app-track-list>
          </div>

          <!----------------- PLAYER ----------------->
          <div *ngIf="activeTrack$ | async">
            <app-player [track$]="activeTrack$"></app-player>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!----------------- NOT CONNECTED TO SPOTIFY ----------------->
<ng-template #notConnected>
  <div fxFlexFill fxLayoutAlign="center center">
    <div fxFlex class="text-centered">
      <h2>Log in to Spotify</h2>
      <p>You need to be connected to load your songs.</p>
      <button mat-raised-button color="accent" (click)="loginSpotify()">
        Login
      </button>
    </div>
  </div>
</ng-template>

<!----------------- NO TRACKS SAVED ----------------->
<ng-template #noTracks>
  <div fxLayout="column" fxFlexFill fxLayoutAlign="center center">
    <div fxFlex="nogrow">
      <div fxFlex="nogrow" class="text-centered">
        <h2>Almost there</h2>
        <p>
          We need to load your songs from Spotify, it may take a few minutes.
        </p>
        <button mat-raised-button color="accent" (click)="loadPlaylist()">
          Load music
        </button>
      </div>
    </div>
    <div
      fxFlex="nogrow"
      class="text-centered margin-5"
      *ngIf="isStoreLoading$ | async"
    >
      <mat-spinner></mat-spinner>
    </div>
  </div>
</ng-template>

<!----------------- NO PLAYLIST ACTIVE ----------------->
<ng-template #noActivePlaylist>
  <div fxFlexFill fxLayout="column" fxLayoutAlign="start center">
    <div fxFlex="15"></div>
    <h3 fxFlex="nogrow" class="text-centered">No playlist selected</h3>
    <p fxFlex="nogrow" class="text-centered">
      Select a playlist to load its tracks
    </p>
    <mat-icon fxFlexOffset="10" fxFlex="nogrow" class="icon" svgIcon="arrow"></mat-icon>
  </div>
</ng-template>
